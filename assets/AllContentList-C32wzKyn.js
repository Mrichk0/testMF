import{r as g,j as a,A as T,u as E,a as L,R as I,b as M,c as z,d as Y,e as k}from"./index-OVXgv9DV.js";var p=new Map,N=new WeakMap,R=0,D=void 0;function P(e){return e?(N.has(e)||(R+=1,N.set(e,R.toString())),N.get(e)):"0"}function V(e){return Object.keys(e).sort().filter(t=>e[t]!==void 0).map(t=>`${t}_${t==="root"?P(e.root):e[t]}`).toString()}function q(e){const t=V(e);let l=p.get(t);if(!l){const u=new Map;let d;const o=new IntersectionObserver(r=>{r.forEach(n=>{var i;const s=n.isIntersecting&&d.some(v=>n.intersectionRatio>=v);e.trackVisibility&&typeof n.isVisible>"u"&&(n.isVisible=s),(i=u.get(n.target))==null||i.forEach(v=>{v(s,n)})})},e);d=o.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),l={id:t,observer:o,elements:u},p.set(t,l)}return l}function F(e,t,l={},u=D){if(typeof window.IntersectionObserver>"u"&&u!==void 0){const i=e.getBoundingClientRect();return t(u,{isIntersecting:u,target:e,intersectionRatio:typeof l.threshold=="number"?l.threshold:0,time:0,boundingClientRect:i,intersectionRect:i,rootBounds:i}),()=>{}}const{id:d,observer:o,elements:r}=q(l),n=r.get(e)||[];return r.has(e)||r.set(e,n),n.push(t),o.observe(e),function(){n.splice(n.indexOf(t),1),n.length===0&&(r.delete(e),o.unobserve(e)),r.size===0&&(o.disconnect(),p.delete(d))}}function W({threshold:e,delay:t,trackVisibility:l,rootMargin:u,root:d,triggerOnce:o,skip:r,initialInView:n,fallbackInView:i,onChange:s}={}){var v;const[f,h]=g.useState(null),y=g.useRef(),[S,j]=g.useState({inView:!!n,entry:void 0});y.current=s,g.useEffect(()=>{if(r||!f)return;let _;return _=F(f,(c,b)=>{j({inView:c,entry:b}),y.current&&y.current(c,b),b.isIntersecting&&o&&_&&(_(),_=void 0)},{root:d,rootMargin:u,threshold:e,trackVisibility:l,delay:t},i),()=>{_&&_()}},[Array.isArray(e)?e.toString():e,f,d,u,o,r,l,i,t]);const x=(v=S.entry)==null?void 0:v.target,C=g.useRef();!f&&x&&!o&&!r&&C.current!==x&&(C.current=x,j({inView:!!n,entry:void 0}));const m=[h,S.inView,S.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}const K=g.memo(({title:e,description:t,buttonName:l,photoUrl:u,onProgramClick:d,saveButton:o,content:r})=>{const[n,i]=g.useState(!1),s=()=>{i(!0)};return a.jsxs("div",{className:"course-item",children:[a.jsx("h2",{className:"course-title",children:e}),t!=="Field not found"&&a.jsx("p",{className:"course-description",children:t}),u&&!n&&a.jsx("img",{src:u,alt:e,className:"course-filter__course-image",width:300,height:200,loading:"lazy",onError:s}),a.jsx("div",{className:"course-details",children:a.jsx(T,{content:r})}),a.jsxs("div",{className:"course-actions",children:[a.jsx("button",{onClick:d,className:"program-button",children:l}),o]})]})}),O="_yearsList_1twmy_1",U="_yearButton_1twmy_14",G="_yearButtonActive_1twmy_23",H="_yearButtonDisabled_1twmy_28",A={yearsList:O,yearButton:U,yearButtonActive:G,yearButtonDisabled:H},J=()=>{const{selectedYear:e,setSelectedYear:t,filters:l,selectedCategory:u,selectedSubcategories:d}=E(),{data:o}=L({selectedCategory:u,selectedSubcategories:d,filters:l,selectedYear:e}),r=g.useCallback(s=>{t(e===s?null:s)},[e,t]),n=g.useMemo(()=>{const s=new Date().getFullYear();return Array.from({length:s-2016+1},(v,f)=>2016+f)},[]),i=g.useMemo(()=>{if(!o||!o.pages)return new Set;const s=new Set;return o.pages.forEach(v=>{v.data.forEach(f=>{f.years&&Array.isArray(f.years)&&f.years.forEach(h=>{h.years_id&&typeof h.years_id.year=="number"&&s.add(h.years_id.year)})})}),s},[o]);return a.jsx("div",{className:A.yearsList,children:n.map(s=>a.jsx("button",{onClick:()=>r(s),className:`${A.yearButton} ${e===s?A.yearButtonActive:""} ${i.has(s)?"":A.yearButtonDisabled}`,children:s},s))})},Q=({content:e,className:t=""})=>{const{t:l}=M(),{addSavedContent:u,removeSavedContent:d,savedContent:o}=z(),r=e==null?void 0:e.id,n=o.some(s=>s.id===r),i=g.useCallback(()=>{if(!r){console.error("Cannot save/remove content without an id");return}if(n)d(r);else{const s={id:r,slug:e.slug,translations:e.translations,category:e.category};u(s)}},[n,e,r,u,d]);return r?a.jsx("button",{onClick:i,className:`save-content-button ${n?"saved":""} ${t}`,children:l(n?"remove":"save")}):null},X=I.memo(Q),Z="_allContentList_kszeq_1",ee="_loading_kszeq_6",te="_error_kszeq_6",se="_loader_kszeq_6",re={allContentList:Z,loading:ee,error:te,loader:se},ne="http://0.0.0.0:8055",ae=e=>{var t;return((t=e==null?void 0:e.category)==null?void 0:t.slug)||"uncategorized"},oe=()=>{const{t:e}=M(),t=Y(),{filters:l,selectedCategory:u,selectedSubcategories:d,selectedYear:o}=E(),{data:r,fetchNextPage:n,hasNextPage:i,isFetchingNextPage:s,isLoading:v,isError:f,error:h}=L({selectedCategory:u,selectedSubcategories:d,filters:l,selectedYear:o}),{getTranslation:y}=k(),{ref:S,inView:j}=W({threshold:0});g.useEffect(()=>{j&&i&&!s&&n()},[j,n,i,s]);const x=g.useCallback(c=>{const b=ae(c);t(`/${b}/${c.slug}`)},[t]),C=g.useMemo(()=>(r==null?void 0:r.pages.flatMap(c=>c.data))??[],[r]),m=g.useMemo(()=>C.map(c=>{if(!c)return null;const b=`content-${c.id}-${c.slug}`,w=y(c,"title"),B=y(c,"description"),$=y(c,"button_name");return!w||!B||!$?(console.warn(`Missing translation for content: ${c.id}`),null):a.jsx(K,{title:w,description:B,buttonName:$,photoUrl:c.cover?`${ne}/assets/${c.cover}`:void 0,onProgramClick:()=>x(c),saveButton:a.jsx(X,{content:c},`save-${b}`),content:c},b)}).filter(Boolean),[C,y,x]),_=g.useMemo(()=>v&&C.length===0?a.jsx("div",{className:"loader",children:e("loading")}):f?a.jsx("div",{className:"error",children:e("error",{message:h.message})}):C.length===0?a.jsx("div",{className:"no-content",children:e("noContent")}):m.length===0?a.jsx("div",{className:"no-content",children:e("noValidContent")}):a.jsxs("ul",{className:re.allContentList,children:[m,(i||s)&&a.jsx("div",{ref:S,className:"loader",children:e(s?"loading":"loadMore")})]}),[v,f,C,m,i,s,e,h]);return a.jsxs(a.Fragment,{children:[a.jsx(J,{}),_]})},le=I.memo(oe);export{le as default};
//# sourceMappingURL=AllContentList-C32wzKyn.js.map
